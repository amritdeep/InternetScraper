require 'rubygems'
# require 'restclient'
require 'nokogiri'
require 'pry'
require 'JSON'
require 'csv'
require 'mechanize'
require 'logger'

zip_array = [76621,79311,79601,79602,79603,79604,79605,79606,79608,79697,79698,79699,77326,79713,75001,78101,79001,79220,78330,79221,78516,79002,75410,76430,76008,78332,78333,77411,75002,75013,78935,79003,79830,79831,79832,77412,75925,76009,77511,77512,76225,79101,79102,79103,79104,79105,79106,79107,79108,79109,79110,79111,79114,79116,79117,79118,79119,79120,79121,79124,79159,79166,79168,79172,79174,79178,79185,79187,79189,79312,77514,77830,79714,77515,77516,75409,75550,79501,79821,79313,75926,76622,78335,78336,76351,76226,76001,76002,76003,76004,76005,76006,76007,76010,76011,76012,76013,76014,76015,76016,76017,76018,76019,76094,76096,78338,75750,76820,78001,75411,78827,79502,78002,75751,75752,75551,76227,73301,73344,78701,78702,78703,78704,78705,78708,78709,78710,78711,78712,78713,78714,78715,78716,78717,78718,78719,78720,78721,78722,78723,78724,78725,78726,78727,78728,78729,78730,78731,78732,78733,78734,78735,78736,78737,78738,78739,78741,78742,78744,78745,78746,78747,78748,78749,78750,78751,78752,78753,78754,78755,78756,78757,78758,78759,78760,78761,78762,78763,78764,78765,78766,78767,78768,78769,78772,78773,78774,78778,78779,78780,78781,78783,78785,78786,78788,78789,78798,78799,77950,76623,75554,75630,79503,76624,76020,76098,77518,75412,75413,79504,76821,79718,78003,76823,78339,75101,77413,78828,76930,75102,79719,76511,78602,78829,77519,77404,77414,78340,77520,77521,77522,77417,77701,77702,77703,77704,77705,77706,77707,77708,77709,77710,77713,77720,77725,77726,75631,76021,76022,76095,77831,78102,78104,77401,77402,76228,75414,77418,78604,76513,78342,75415,75754,78341,76824,79505,78107,78004,78605,79834,76932,75755,75797,79720,79721,78830,78005,78343,75555,79506,78606,76432,79314,78931,77419,75556,76626,77951,75416,75424,76352,76433,78607,76627,78006,78015,75417,77420,75928,75418,79005,79007,79008,79009,76230,76023,79010,78832,76825,76628,75420,77422,76424,76629,77833,77834,77611,76426,78608,79011,75929,75930,76933,75931,76827,77423,75421,79316,75756,78520,78521,78522,78523,78526,76801,76803,76804,76630,78344,77801,77802,77803,77805,77806,77807,77808,76427,78609,76518,78610,75831,79508,79320,75757,78163,77612,76354,76828,75932,76028,76097,76519,78611,77835,79012,76357,76631,79013,76429,75135,77836,75933,78007,77837,75934,76520,78833,75422,78008,79014,75103,79835,79015,79016,78133,76435,76934,76436,78932,78834,75006,75007,75010,75011,75633,75636,76831,78009,78933,78836,75832,78612,75104,75106,77415,78613,78630,79223,75423,75009,75935,78010,75833,75834,75758,77530,79018,78347,77426,78011,75105,76832,75936,76431,75425,79201,79225,76632,77613,76633,75937,77838,78012,76935,78108,76437,79226,75426,79019,75637,76031,76033,77327,77328,76634,79836,77531,79510,79511,77331,76834,77840,77841,77842,77843,77844,77845,77428,76034,76233,75938,79512,78934,76442,78535,78013,75428,75429,75431,78837,78838,78349,77850,77301,77302,77303,77304,77305,77306,77384,77385,78109,75558,76635,75432,75121,75019,75099,76522,78401,78402,78403,78404,78405,78406,78407,78408,78409,78410,78411,78412,78413,78414,78415,78416,78417,78418,78419,78426,78427,78460,78461,78463,78465,78466,78467,78468,78469,78470,78471,78472,78473,78474,78475,78476,78477,78478,78480,75939,75109,75110,75151,78614,79021,78014,78615,76636,79730,75114,79731,76637,76638,76035,75835,77532,79322,76443,79227,76036,78839,77954,75433,75759,75434,75760,77410,77429,77433,78850,75638,77533,78616,79022,77332,75201,75202,75203,75204,75205,75206,75207,75208,75209,75210,75211,75212,75214,75215,75216,75217,75218,75219,75220,75221,75222,75223,75224,75225,75226,75227,75228,75229,75230,75231,75232,75233,75234,75235,75236,75237,75238,75240,75241,75242,75243,75244,75245,75246,75247,75248,75249,75250,75251,75252,75253,75254,75258,75260,75261,75262,75263,75264,75265,75266,75267,75270,75275,75277,75283,75284,75285,75286,75287,75301,75303,75310,75312,75313,75315,75320,75323,75326,75334,75336,75339,75340,75342,75343,75344,75353,75354,75355,75356,75357,75358,75359,75360,75363,75364,75367,75368,75370,75371,75372,75373,75374,75376,75378,75379,75380,75381,75382,75386,75387,75388,75389,75390,75391,75392,75393,75394,75395,75396,75397,75398,77430,77534,77431,77432,79024,76523,79025,76639,77535,75639,75559,76444,77852,76234,77536,78840,78841,78842,78847,78617,79837,78536,75020,75021,76439,76201,76202,76203,76204,76205,76206,76207,76208,76209,76210,79323,75435,76445,75115,75123,75436,77538,78016,77614,75640,75941,79229,77539,75437,78017,77853,79027,78350,77333,75438,77334,79230,75838,78537,76836,78618,75942,79231,75943,75560,78619,78620,78351,78851,76446,79029,75116,75137,75138,79516,79607,77434,78852,78853,76802,79031,77435,76448,75641,78111,75439,78538,76524,76837,75117,78539,78540,78541,79032,77957,78352,77436,77437,78860,79901,79902,79903,79904,79905,79906,79907,79908,79910,79911,79912,79913,79914,79915,79916,79917,79918,79920,79922,79923,79924,79925,79926,79927,79928,79929,79930,79931,79932,79934,79935,79936,79937,79938,79940,79941,79942,79943,79944,79945,79946,79947,79948,79949,79950,79951,79952,79953,79954,79955,79958,79960,79961,79968,79976,79978,79980,79990,79995,79996,79997,79998,79999,88510,88511,88512,88513,88514,88515,88516,88517,88518,88519,88520,88521,88523,88524,88525,88526,88527,88528,88529,88530,88531,88532,88533,88534,88535,88536,88538,88539,88540,88541,88542,88543,88544,88545,88546,88547,88548,88549,88550,88553,88554,88555,88556,88557,88558,88559,88560,88561,88562,88563,88565,88566,88567,88568,88569,88570,88571,88572,88573,88574,88575,88576,88577,88578,88579,88580,88581,88582,88583,88584,88585,88586,88587,88588,88589,88590,88595,76936,76360,78621,75839,78938,76640,77440,78112,75118,78543,75642,75440,78019,78353,76452,75441,75119,75120,79324,76937,76238,79233,75944,76039,76040,75124,77615,76525,79838,75840,78545,78355,78113,77960,75442,79033,79325,75132,78940,78622,75125,79326,78623,76526,78941,75762,79234,76527,78114,75022,75027,75028,79235,79517,77855,79034,76239,75126,76041,79733,79734,79839,76841,79735,76101,76102,76103,76104,76105,76106,76107,76108,76109,76110,76111,76112,76113,76114,76115,76116,76118,76119,76120,76121,76122,76123,76124,76126,76129,76130,76131,76132,76133,76134,76135,76136,76137,76140,76147,76148,76150,76155,76161,76162,76163,76164,76177,76179,76181,76185,76191,76192,76193,76195,76196,76197,76198,76199,78021,77961,77856,75763,77616,78624,76842,77541,77542,78357,77545,77546,77549,79035,75034,75035,79036,76641,75127,77441,78358,79738,76240,76241,77547,75764,77550,77551,77552,77553,77554,77555,77962,78547,79739,79758,75040,75041,75042,75043,75044,75045,75046,75047,75049,75946,77442,75643,76528,76596,76597,76598,76599,77857,78022,78626,78627,78628,78115,78942,77617,78116,75644,75645,79518,79740,75647,77443,76043,78943,75443,76044,75444,79519,79741,76844,77963,78629,76908,77335,76453,76245,76363,76454,76845,76449,76450,76048,76049,75050,75051,75052,75053,75054,75140,79742,76050,76530,75844,76051,76099,75401,75402,75403,75404,76246,78359,76642,79039,77619,75845,78548,79040,78360,75058,76455,79236,77444,79041,77964,75650,76117,76531,79520,77622,77560,79042,77561,78549,76548,75651,78550,78551,78552,78553,78631,76364,79043,79044,78632,79521,76052,75765,79525,77859,78361,79237,76533,78023,75948,77445,75652,75653,75654,76365,79045,79526,76643,76848,76457,78557,79046,77623,77562,77624,76645,77563,78117,77967,77447,76534,76366,78861,75446,75561,78657,77001,77002,77003,77004,77005,77006,77007,77008,77009,77010,77011,77012,77013,77014,77015,77016,77017,77018,77019,77020,77021,77022,77023,77024,77025,77026,77027,77028,77029,77030,77031,77032,77033,77034,77035,77036,77037,77038,77039,77040,77041,77042,77043,77044,77045,77046,77047,77048,77049,77050,77051,77052,77053,77054,77055,77056,77057,77058,77059,77060,77061,77062,77063,77064,77065,77066,77067,77068,77069,77070,77071,77072,77073,77074,77075,77076,77077,77078,77079,77080,77081,77082,77083,77084,77085,77086,77087,77088,77089,77090,77091,77092,77093,77094,77095,77096,77097,77098,77099,77201,77202,77203,77204,77205,77206,77207,77208,77209,77210,77212,77213,77215,77216,77217,77218,77219,77220,77221,77222,77223,77224,77225,77226,77227,77228,77229,77230,77231,77233,77234,77235,77236,77237,77238,77240,77241,77242,77243,77244,77245,77246,77247,77248,77249,77250,77251,77252,77253,77254,77255,77256,77257,77258,77259,77260,77261,77262,77263,77265,77266,77267,77268,77269,77270,77271,77272,77273,77274,77275,77276,77277,77278,77279,77280,77282,77284,77285,77286,77287,77288,77289,77290,77291,77292,77293,77294,77296,77297,77298,77299,75459,76648,77336,77337,75656,77564,77338,77346,77347,77396,77448,78024,75949,77320,77340,77341,77342,77343,77344,77348,77349,76053,76054,75141,78634,78635,79329,79743,78944,77968,78362,78025,77861,76367,79527,79744,76649,76650,75014,75015,75016,75017,75037,75038,75039,75060,75061,75062,75063,76651,76055,75447,76458,75766,76537,75951,79528,75657,76459,75846,75954,78636,75658,76538,75659,75164,76058,78026,75660,76849,79330,76247,76369,75661,78118,77449,77450,77491,77492,77493,77494,75142,76059,76244,76248,77565,75143,76539,78027,77451,78119,75847,76060,77452,75144,79745,79051,78028,78029,75562,75662,75663,76540,76541,76542,76543,76544,76545,76546,76547,76549,78638,78639,78363,78364,77325,77339,77345,75956,75848,75448,76939,78870,79748,79529,76652,76653,77625,79052,76249,77862,78640,78558,78039,78559,78945,78560,77568,77571,77572,78872,77969,78121,78562,77970,75449,76644,75666,75450,75065,77566,79239,79331,76550,75134,75146,77453,75667,78871,78040,78041,78042,78043,78044,78045,78046,78049,75770,78561,75849,78843,75166,79530,79053,77573,77574,78873,78641,78645,78646,78946,75451,78122,79054,77350,79240,78050,79749,75850,75452,76654,79336,79338,75029,75057,75067,75077,78947,77575,78642,76061,78948,75771,75563,76250,76461,78563,76462,79056,77454,75068,76554,79339,77577,77351,77399,78643,78644,79241,75564,76852,77971,76853,76854,75453,75668,75669,75601,75602,75603,75604,75605,75606,75607,75608,75615,79342,78564,79532,76655,79343,78565,78566,78567,76656,77455,75851,76460,76855,78568,79401,79402,79403,79404,79405,79406,79407,79408,79409,79410,79411,79412,79413,79414,79415,79416,79423,79424,79430,79452,79453,79457,79464,79490,79491,79493,79499,79533,75901,75902,75903,75904,75915,78648,77657,78569,77863,78052,75147,75156,78054,77864,77353,77354,77355,75148,76660,78652,78653,76063,77578,79344,79842,78654,79843,75566,78124,77456,76661,77865,75670,75671,75672,76664,78655,75958,79535,76856,79058,79244,77457,78368,75567,77626,78656,76857,75772,76064,79752,79534,78650,76657,75565,78651,78123,79243,78501,78502,78503,78504,78505,77973,75069,75070,75071,79057,79345,78055,76370,75454,76858,79245,76859,79754,78570,76940,76665,75458,79536,76666,76941,75149,75150,75180,75181,75185,75187,76667,77974,79059,78056,77458,79755,79701,79702,79703,79704,79705,79706,79707,79708,79710,79711,79712,76065,75852,75959,76556,76861,76670,76862,77866,76066,75680,75773,78125,76067,76068,76463,78369,78572,78573,78574,77459,77489,79061,79756,77580,76251,75853,77316,77356,76557,78057,76464,76671,76465,79062,79346,75960,77975,76558,76673,75681,75455,75456,75457,78058,76252,78949,79347,76864,77867,76371,75778,76253,75961,75962,75963,75964,75965,77460,75568,75569,78059,76127,77868,77869,79063,75779,77627,77461,76070,75173,77870,75570,78130,78131,78132,78135,77357,79350,79383,75682,75780,78950,77358,76071,76372,75966,78140,76255,79537,76559,77629,78141,77871,78142,77315,76180,76182,77872,76865,79759,79538,77976,79539,77359,78951,78060,75855,79247,78370,79760,79761,79762,79763,79764,79765,79766,79768,79769,79351,76561,78371,76373,79540,77463,76466,78575,76374,79064,75571,77360,77630,77631,77632,78372,77639,77464,75683,79770,78658,79541,75684,76943,79248,78659,76866,77465,75801,75802,75803,75882,75152,76484,76467,79065,79066,78143,79068,78144,75685,76073,75460,75461,75462,77501,77502,77503,77504,77505,77506,77507,77508,77466,75468,78145,77581,77584,77588,78061,76485,75469,79772,78062,76564,76676,78576,75856,79776,79353,76486,79070,79250,76377,78146,75470,78660,78691,78577,75471,77467,76258,77362,75968,78063,75686,77977,79355,79072,79073,75023,75024,75025,75026,75074,75075,75086,75093,75094,77363,78064,77468,78952,75472,77978,77364,75969,76259,76869,76487,78373,77640,77641,77642,77643,77650,78578,77979,78598,77651,77982,77365,78374,79356,78065,78147,75076,76565,75473,75153,75782,76678,78661,77446,78375,79845,75687,76870,75407,76468,78579,75078,76679,76566,76469,79777,79251,79252,75572,78877,75474,79255,75783,76077,79357,75475,76470,79778,79366,75858,75476,78580,77582,76680,78376,75154,78662,79846,75573,78377,75784,76078,75155,77873,75080,75081,75082,75083,75085,76681,76871,77406,77469,76682,76261,78879,78582,78583,78066,76093,76471,77367,78379,76262,76299,77875,79256,76945,78380,79543,76872,79544,77470,76567,78381,78382,78880,75032,75087,76873,76569,78584,77368,76874,79358,78953,79545,76570,77471,77583,76684,75157,76263,79546,78663,78664,78680,78681,78682,78683,78954,76875,75030,75088,75089,75477,75189,79547,79548,78151,75785,77369,78881,77655,75048,75788,76264,78152,76265,76571,78585,79847,75478,79077,76901,76902,76903,76904,76905,76906,76909,78201,78202,78203,78204,78205,78206,78207,78208,78209,78210,78211,78212,78213,78214,78215,78216,78217,78218,78219,78220,78221,78222,78223,78224,78225,78226,78227,78228,78229,78230,78231,78232,78233,78234,78235,78236,78237,78238,78239,78240,78241,78242,78243,78244,78245,78246,78247,78248,78249,78250,78251,78252,78253,78254,78255,78256,78257,78258,78259,78260,78261,78262,78263,78264,78265,78266,78268,78269,78270,78275,78278,78279,78280,78283,78284,78285,78286,78287,78288,78289,78291,78292,78293,78294,78295,78296,78297,78298,78299,75972,78586,78384,79849,77473,78588,78589,78666,78667,78590,76877,78067,79848,78383,79078,76266,76878,78591,77510,77517,78592,78593,76472,79780,77585,78385,76685,75479,78154,78956,76573,76379,75688,75480,75158,77586,77983,75159,79359,77474,78594,78155,78156,75689,79360,76380,79363,79079,79781,75973,77371,76311,77475,75090,75091,75092,77984,77876,76474,79851,77656,76949,79257,75574,77476,78387,79080,78389,79364,76267,78159,78957,79367,77878,79549,79550,78069,77879,76950,77659,76481,77587,78597,79258,76092,76268,79369,79081,78669,77372,77373,77379,77380,77381,77382,77383,77386,77387,77388,77389,77391,77393,78070,79082,76082,79370,77660,77477,77497,79553,79782,78670,76880,76401,76402,76951,79083,78160,78671,77661,79084,76475,75859,77986,79371,77478,77479,77487,77496,78595,75481,75482,75483,79085,75486,79372,75182,79086,76270,78161,77480,77987,79556,79560,78390,79373,75487,76882,78883,79783,75691,76574,75860,76686,76883,75488,77988,79259,76501,76502,76503,76504,76505,76508,75974,75861,75880,75884,75886,76953,79852,75160,75161,75501,75503,75504,75505,75507,75599,77590,77591,77592,79087,75056,77374,77989,77481,76577,76687,76578,78071,76483,78072,75975,76271,77990,79376,76476,75489,77375,77377,79853,78672,79785,79786,79561,75490,75163,75862,75789,76579,78162,79088,79261,79562,79563,75701,75702,75703,75704,75705,75706,75707,75708,75709,75710,75711,75712,75713,75798,75799,78391,79091,78148,78150,78884,78801,78802,79854,76884,76689,76885,76272,75790,75495,79855,77482,76955,77991,78885,79092,76084,76886,76384,76385,77901,77902,77903,77904,77905,77662,77670,77663,76887,78073,76888,77376,76701,76702,76703,76704,76705,76706,76707,76708,76710,76711,76714,76715,76716,76795,76797,76798,76799,77483,78959,79093,78673,76957,77484,77485,77597,76690,78960,78074,77664,78961,77880,75692,76958,75165,75167,75168,79094,76085,76086,76087,76088,77598,77993,78962,76388,78674,79377,77881,79095,79378,75976,78596,78599,76691,77486,78963,79565,77994,75485,75097,77488,79096,77882,79097,75693,79379,75791,76273,75491,79380,76692,78075,76490,76301,76302,76305,76306,76307,76308,76309,76310,79788,75977,79098,77318,77378,78675,75169,75172,79381,78676,75492,76389,75493,79566,79789,77665,75494,75792,79567,75978,75496,79382,75865,75694,78393,76491,75979,75990,76712,76693,78677,75098,78886,75497,77995,78164,78076,75980,76890]

# zip_array = [76621, 75038]

CSV.open("internet-providers.csv", "wb") do |csv|
	zip_array.each do |zip|
	
		mechanize = Mechanize.new
		# mechanize.log = Logger.new "internet.log"

		mechanize.get("http://www.highspeedinternet.com/") do |page|
	  		search_result = page.form_with(:class => "zip-form") do |search|
	    		search.zip = zip
		  	end.submit

			  	search_result.search(".provider").each do |provider|
			  		provider_result = provider.search(".features > a").text
			  		speed_result = provider.search(".speed").text
			  		rating_result = provider.search(".user-rating").children[1].attributes['data-clickedon'].value
			  		csv << [zip, provider_result, speed_result, rating_result]
			  	end
		end
	end
# end
end


